<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBDB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/styles.css">
</head>

<body>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main -->
    <div class="container mt-5">
        <!-- Nav Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="vbdb-tab" data-bs-toggle="tab" data-bs-target="#vbdb" type="button"
                    role="tab" aria-controls="vbdb" aria-selected="true">VBDB</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="live-tab" data-bs-toggle="tab" data-bs-target="#live" type="button"
                    role="tab" aria-controls="live" aria-selected="false">Live</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button"
                    role="tab" aria-controls="schedule" aria-selected="false">Schedule</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="teams-tab" data-bs-toggle="tab" data-bs-target="#teams" type="button"
                    role="tab" aria-controls="teams" aria-selected="false">Teams</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rankings-tab" data-bs-toggle="tab" data-bs-target="#rankings" type="button"
                    role="tab" aria-controls="rankings" aria-selected="false">Rankings</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="histories-tab" data-bs-toggle="tab" data-bs-target="#histories"
                    type="button" role="tab" aria-controls="histories" aria-selected="false">Histories</button>
            </li>
        </ul>
        <!-- Main Div for tabs content -->
        <div class="tab-content" id="myTabContent">
            <!-- Home tab -->
            <div class="tab-pane fade show active" id="vbdb" role="tabpanel" aria-labelledby="vbdb-tab">
                <h2 class="text-center">VBDB Content</h2>
                <p class="text-center">Welcome to VBDB!</p>
            </div>

            <!-- Live tab -->
            <div class="tab-pane fade" id="live" role="tabpanel" aria-labelledby="live-tab">
                <h2 class="text-center">Live Scores</h2>
                <div class="table-responsive">
                    <table id="liveTable" class="table table-dark table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Home Team</th>
                                <th>Away Team</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- We'll fill this with rows of data from the CSV -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedule tab -->
            <div class="tab-pane fade" id="schedule" role="tabpanel" aria-labelledby="schedule-tab">
                <h2 class="text-center">Schedule Content</h2>
                <!-- Dropdown for Searchs -->
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6 col-12 mb-3">
                            <select class="form-select" name="conference-schedule-dropdown"
                                id="conference-schedule-dropdown" onchange="filterTable()">
                                <option selected>Conference</option>
                                <option value="AE">AE</option>
                                <option value="AAC">AAC</option>
                                <option value="A-10">A-10</option>
                                <option value="ACC">ACC</option>
                                <option value="ASUN">ASUN</option>
                                <option value="Big 12">Big 12</option>
                                <option value="BE">BE</option>
                                <option value="BSC">BSC</option>
                                <option value="Big Ten">Big Ten</option>
                                <option value="BWC">BWC</option>
                                <option value="CAA">CAA</option>
                                <option value="C-USA">C-USA</option>
                                <option value="HL">HL</option>
                                <option value="MAAC">MAAC</option>
                                <option value="MAC">MAC</option>
                                <option value="MEAC">MEAC</option>
                                <option value="MVC">MVC</option>
                                <option value="MW">MW</option>
                                <option value="NEC">NEC</option>
                                <option value="OVC">OVC</option>
                                <option value="Pac-12">Pac-12</option>
                                <option value="PL">PL</option>
                                <option value="SEC">SEC</option>
                                <option value="SoCon">SoCon</option>
                                <option value="SLC">SLC</option>
                                <option value="SWAC">SWAC</option>
                                <option value="SBC">SBC</option>
                                <option value="Ivy">Ivy</option>
                                <option value="Summit">Summit</option>
                                <option value="WCC">WCC</option>
                                <option value="WAC">WAC</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-12 mb-3">
                            <select class="form-select form-select" name="teams-schedule-dropdown"
                                id="teams-schedule-dropdown">
                                <option selected>School</option>
                                <option value></option>
                            </select>
                        </div>

                    </div>
                </div>
                <div class="table-responsive">
                    <table id="schTable" class="table table-dark table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Match</th>
                                <th>Result</th>
                                <th>Scores</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- We'll fill this with rows of data from the CSV -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Teams tab -->
            <div class="tab-pane fade" id="teams" role="tabpanel" aria-labelledby="teams-tab">
                <h2 class="text-center">NCAA D1 Schools</h2>
                <div class="text-center">
                    <a href="https://raw.githubusercontent.com/widbuntu/vbdb-info/main/data/teams.csv"
                        style="color: white; text-decoration: none;" target="_blank">
                        <caption>https://raw.githubusercontent.com/widbuntu/vbdb-info/main/data/teams.csv</caption>
                    </a>
                </div>
                <div class="table-responsive">
                    <table id="teamsTable" class="table table-dark table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Team</th>
                                <th>Conference</th>
                                <th>School URL</th>
                                <th>Conference Full</th>
                                <th>Division</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- We'll fill this with rows of data from the CSV -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Rankings tab -->
            <div class="tab-pane fade" id="rankings" role="tabpanel" aria-labelledby="rankings-tab">
                <h2 class="text-center">Rankings Content</h2>
                <p>This is the content for the Rankings tab.</p>
            </div>

            <!-- Histories tab -->
            <div class="tab-pane fade" id="histories" role="tabpanel" aria-labelledby="histories-tab">
                <h2 class="text-center">Histories Content</h2>
                <p>This is the content for the Histories tab.</p>
            </div>

            <!-- End of content -->
        </div>
    </div>

    <!-- Scripts -->
    <!-- Script to run teams tab -->
    <script>
// Global variables
let allRows = [];
let conferenceToTeams = new Map();
let conferenceAbbreviations = new Map();

// Fetch teams data
fetch('https://raw.githubusercontent.com/widbuntu/vbdb-info/main/data/teams2.csv')
    .then(response => response.text())
    .then(csvData => {
        const rows = csvData.trim().split('\n');
        const table = document.getElementById('teamsTable');
        const tbody = table.querySelector('tbody');
        const conferenceDropdown = document.getElementById('conference-schedule-dropdown');

        // Clear existing options in conference dropdown
        conferenceDropdown.innerHTML = '<option selected>Conference</option>';

        rows.slice(1).forEach(row => {
            const [team, conference] = row.split(',').map(item => item.trim());

            // Populate conferenceToTeams map
            if (!conferenceToTeams.has(conference)) {
                conferenceToTeams.set(conference, []);
                
                // Add conference to dropdown
                const option = document.createElement('option');
                option.value = conference;
                option.textContent = conference;
                conferenceDropdown.appendChild(option);
            }
            conferenceToTeams.get(conference).push(team);

            // Create table row
            const tr = document.createElement('tr');
            [team, conference].forEach(cell => {
                const cellElement = document.createElement('td');
                cellElement.textContent = cell;
                tr.appendChild(cellElement);
            });
            tbody.appendChild(tr);
        });

        // Sort conferences in the dropdown
        Array.from(conferenceDropdown.options)
            .slice(1) // Skip the "Conference" option
            .sort((a, b) => a.text.localeCompare(b.text))
            .forEach(option => conferenceDropdown.add(option));

        // Create conference abbreviations map
        conferenceAbbreviations = new Map([
            ['America East Conference', 'AE'],
            ['American Athletic Conference', 'AAC'],
            ['Atlantic 10 Conference', 'A-10'],
            ['Atlantic Coast Conference', 'ACC'],
            ['ASUN Conference', 'ASUN'],
            ['Big 12 Conference', 'Big 12'],
            ['Big East Conference', 'BE'],
            ['Big Sky Conference', 'BSC'],
            ['Big Ten Conference', 'Big Ten'],
            ['Big West Conference', 'BWC'],
            ['Colonial Athletic Association', 'CAA'],
            ['Conference USA', 'C-USA'],
            ['Horizon League', 'HL'],
            ['Ivy League', 'Ivy'],
            ['Metro Atlantic Athletic Conference', 'MAAC'],
            ['Mid-American Conference', 'MAC'],
            ['Mid-Eastern Athletic Conference', 'MEAC'],
            ['Missouri Valley Conference', 'MVC'],
            ['Mountain West Conference', 'MW'],
            ['Northeast Conference', 'NEC'],
            ['Ohio Valley Conference', 'OVC'],
            ['Pac-12 Conference', 'Pac-12'],
            ['Patriot League', 'PL'],
            ['Southeastern Conference', 'SEC'],
            ['Southern Conference', 'SoCon'],
            ['Southland Conference', 'SLC'],
            ['Southwestern Athletic Conference', 'SWAC'],
            ['Sun Belt Conference', 'SBC'],
            ['The Summit League', 'Summit'],
            ['West Coast Conference', 'WCC'],
            ['Western Athletic Conference', 'WAC']
        ]);
    })
    .catch(error => console.error('Error loading teams CSV:', error));

// Fetch schedule data (unchanged)
fetch('https://raw.githubusercontent.com/widbuntu/vbdb-info/refs/heads/main/data/test_sch.csv')
    .then(response => response.text())
    .then(csvData => {
        const rows = csvData.trim().split('\n');
        const table = document.getElementById('schTable');
        const tbody = table.querySelector('tbody');
        rows.slice(1).forEach(row => {
            const rowData = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            const tr = document.createElement('tr');
            rowData.forEach(cell => {
                const cellElement = document.createElement('td');
                cell = cell.trim().replace(/^"|"$/g, '');
                cellElement.textContent = cell;
                tr.appendChild(cellElement);
            });
            tbody.appendChild(tr);
            allRows.push(tr);
        });
    })
    .catch(error => console.error('Error loading schedule CSV:', error));

function filterTable() {
    const conferenceDropdown = document.getElementById('conference-schedule-dropdown');
    const teamDropdown = document.getElementById('teams-schedule-dropdown');
    const selectedConference = conferenceDropdown.value.trim();
    const table = document.getElementById('schTable');
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';

    // Populate teams dropdown based on selected conference
    teamDropdown.innerHTML = '<option selected>School</option>';
    if (selectedConference !== 'Conference') {
        const teams = conferenceToTeams.get(selectedConference) || [];
        teams.sort().forEach(team => {
            const option = document.createElement('option');
            option.value = team;
            option.textContent = team;
            teamDropdown.appendChild(option);
        });
    }

    // Filter table rows
    if (selectedConference === 'Conference') {
        allRows.forEach(row => tbody.appendChild(row.cloneNode(true)));
    } else {
        const conferenceAbbr = conferenceAbbreviations.get(selectedConference) || selectedConference;
        allRows.forEach(row => {
            const matchCell = row.children[1].textContent;
            if (matchCell.includes(conferenceAbbr)) {
                tbody.appendChild(row.cloneNode(true));
            }
        });
    }
}

// Add event listener for team dropdown (unchanged)
document.getElementById('teams-schedule-dropdown').addEventListener('change', function() {
    const selectedTeam = this.value.trim();
    const tbody = document.getElementById('schTable').querySelector('tbody');
    tbody.innerHTML = '';

    if (selectedTeam === 'School') {
        filterTable(); // Revert to conference-based filtering
    } else {
        allRows.forEach(row => {
            const matchCell = row.children[1].textContent;
            if (matchCell.includes(selectedTeam)) {
                tbody.appendChild(row.cloneNode(true));
            }
        });
    }
});
    </script>

    <!-- Script to run live tab -->
    <script>
        // Get today's date in the required format (YYYY/MM/DD)
        let date = new Date().toISOString().split('T')[0].replace(/-/g, '/');

        // Fetch data for the given date
        async function fetchGamesData(date) {
            //const url = `https://proxy.cors.sh/https://data.ncaa.com/casablanca/scoreboard/volleyball-women/d1/${date}/scoreboard.json`;
            //const url = `https://corsproxy.io/?https://data.ncaa.com/casablanca/scoreboard/volleyball-women/d1/${date}/scoreboard.json`;
            const url =
                `https://corsproxy.io/?https://data.ncaa.com/casablanca/scoreboard/volleyball-women/d1/2024/09/21/scoreboard.json`;
            console.log("Fetching from URL:", url);
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                console.log("Data fetched successfully for date:", date);
                return data.games || []; // Return games or an empty array if none exist
            } catch (error) {
                console.error("Error fetching data for date:", date, error);
                return [];
            }
        }

        // Function to populate the table with data
        function populateTable(games) {
            const table = document.getElementById('liveTable');
            const tbody = table.querySelector('tbody');

            // Clear any existing rows in the table body
            tbody.innerHTML = '';

            // Loop through each game and create a new row
            games.forEach(game => {
                const tr = document.createElement('tr');

                // Create and append date, home team, away team, and result cells
                const dateCell = document.createElement('td');
                dateCell.textContent = game.startDate; // Use the appropriate date field from the data
                tr.appendChild(dateCell);

                const homeTeamCell = document.createElement('td');
                homeTeamCell.textContent = game.home.team; // Use the appropriate home team field
                tr.appendChild(homeTeamCell);

                const awayTeamCell = document.createElement('td');
                awayTeamCell.textContent = game.away.team; // Use the appropriate away team field
                tr.appendChild(awayTeamCell);

                const resultCell = document.createElement('td');
                resultCell.textContent = game.status; // Use the appropriate result/status field
                tr.appendChild(resultCell);

                // Append the row to the tbody
                tbody.appendChild(tr);
            });
        }

        // Fetch the data and populate the table
        fetchGamesData(date).then(games => populateTable(games));
    </script>

</body>

</html>